# Unity Rimeè¾“å…¥æ³•é›†æˆ - æµ‹è¯•å¥—ä»¶

è¿™æ˜¯Unity Rimeä¸­æ–‡è¾“å…¥æ³•é›†æˆé¡¹ç›®çš„æµ‹è¯•å¥—ä»¶ï¼ŒåŒ…å«é›†æˆæµ‹è¯•ã€æ€§èƒ½åŸºå‡†æµ‹è¯•ç­‰ã€‚

## æ–‡ä»¶ç»“æ„

```
tests/
â”œâ”€â”€ test_integration.py        # é›†æˆæµ‹è¯•è„šæœ¬
â”œâ”€â”€ performance_benchmark.py   # æ€§èƒ½åŸºå‡†æµ‹è¯•è„šæœ¬
â”œâ”€â”€ benchmark_results.json     # åŸºå‡†æµ‹è¯•ç»“æœ
â””â”€â”€ README.md                 # æœ¬æ–‡æ¡£
```

## æµ‹è¯•è„šæœ¬è¯´æ˜

### 1. test_integration.py - é›†æˆæµ‹è¯•

è¿™ä¸ªè„šæœ¬ç”¨äºæµ‹è¯•æ•´ä¸ªUnity Rimeè¾“å…¥æ³•é›†æˆç³»ç»Ÿçš„åŠŸèƒ½å®Œæ•´æ€§ã€‚

**æµ‹è¯•é¡¹ç›®ï¼š**
- PythonæœåŠ¡å™¨å¯åŠ¨æµ‹è¯•
- Pythonè¿æ¥æµ‹è¯•
- Pythonè¾“å…¥å¤„ç†æµ‹è¯•
- DLLåŠŸèƒ½æµ‹è¯•
- åŸºæœ¬æ€§èƒ½æµ‹è¯•

**è¿è¡Œæ–¹æ³•ï¼š**
```bash
cd tests
python3 test_integration.py
```

**æµ‹è¯•ç»“æœç¤ºä¾‹ï¼š**
```
Unity Rimeè¾“å…¥æ³•é›†æˆ - é›†æˆæµ‹è¯•
==================================================
[2025-07-18 13:10:56] [INFO] æµ‹è¯•ç»“æœæ±‡æ€»:
==================================================
  å¯åŠ¨PythonæœåŠ¡å™¨: å¤±è´¥
  DLLåŠŸèƒ½æµ‹è¯•: é€šè¿‡
  æ€§èƒ½æµ‹è¯•: é€šè¿‡
==================================================
æ€»è®¡: 2/3 ä¸ªæµ‹è¯•é€šè¿‡
```

### 2. performance_benchmark.py - æ€§èƒ½åŸºå‡†æµ‹è¯•

è¿™ä¸ªè„šæœ¬ç”¨äºæµ‹è¯•ä¸åŒå®ç°æ–¹æ¡ˆçš„æ€§èƒ½å·®å¼‚ï¼Œæä¾›è¯¦ç»†çš„æ€§èƒ½æŒ‡æ ‡ã€‚

**æµ‹è¯•é¡¹ç›®ï¼š**
- Pythonæ¨¡å¼å»¶è¿Ÿæµ‹è¯•
- Pythonæ¨¡å¼ååé‡æµ‹è¯•
- Pythonè¾“å…¥å¤„ç†æ€§èƒ½æµ‹è¯•
- DLLæ¨¡å¼æ€§èƒ½æµ‹è¯•
- æ€§èƒ½å¯¹æ¯”åˆ†æ

**è¿è¡Œæ–¹æ³•ï¼š**
```bash
cd tests
python3 performance_benchmark.py
```

**æµ‹è¯•ç»“æœç¤ºä¾‹ï¼š**
```
Unity Rimeè¾“å…¥æ³•é›†æˆ - æ€§èƒ½åŸºå‡†æµ‹è¯•
============================================================
ğŸ“Š DLLæ¨¡å¼æ€§èƒ½æµ‹è¯•
----------------------------------------
DLLæ‰§è¡Œç»Ÿè®¡ (10æ¬¡):
  æœ€å°å€¼: 2.08 ms
  æœ€å¤§å€¼: 6.39 ms
  å¹³å‡å€¼: 4.15 ms
  ä¸­ä½æ•°: 3.91 ms
  æ ‡å‡†å·®: 1.55 ms
```

## æµ‹è¯•ç¯å¢ƒè¦æ±‚

### ç³»ç»Ÿè¦æ±‚
- Python 3.7+
- Linux/macOS/Windows
- ç½‘ç»œè¿æ¥ï¼ˆç”¨äºTCP Socketæµ‹è¯•ï¼‰

### ä¾èµ–åº“
- æ ‡å‡†åº“ï¼šsocket, json, subprocess, threading, time, statistics
- æ— éœ€é¢å¤–å®‰è£…ç¬¬ä¸‰æ–¹åº“

### æµ‹è¯•æ•°æ®
æµ‹è¯•ä½¿ç”¨æ¨¡æ‹Ÿçš„Rimeå¼•æ“ï¼ŒåŒ…å«ä»¥ä¸‹æµ‹è¯•è¯å…¸ï¼š
- "ni" â†’ ["ä½ ", "å°¼", "æ³¥"]
- "hao" â†’ ["å¥½", "å·", "è±ª"]
- "nihao" â†’ ["ä½ å¥½"]
- "wo" â†’ ["æˆ‘", "æ¡", "å§"]
- ç­‰ç­‰

## æµ‹è¯•ç»“æœåˆ†æ

### æ€§èƒ½æŒ‡æ ‡è¯´æ˜

#### å»¶è¿Ÿ (Latency)
- **å®šä¹‰**ï¼šå•æ¬¡è¯·æ±‚çš„å“åº”æ—¶é—´
- **å•ä½**ï¼šæ¯«ç§’ (ms)
- **æµ‹è¯•æ–¹æ³•**ï¼šå‘é€pingè¯·æ±‚å¹¶æµ‹é‡å¾€è¿”æ—¶é—´
- **å…¸å‹å€¼**ï¼š
  - DLLæ¨¡å¼ï¼š< 1 ms
  - Pythonæ¨¡å¼ï¼š10-100 ms

#### ååé‡ (Throughput)
- **å®šä¹‰**ï¼šå•ä½æ—¶é—´å†…å¤„ç†çš„è¯·æ±‚æ•°é‡
- **å•ä½**ï¼šè¯·æ±‚/ç§’ (req/s)
- **æµ‹è¯•æ–¹æ³•**ï¼šåœ¨å›ºå®šæ—¶é—´å†…å‘é€å°½å¯èƒ½å¤šçš„è¯·æ±‚
- **å…¸å‹å€¼**ï¼š
  - DLLæ¨¡å¼ï¼š> 1000 req/s
  - Pythonæ¨¡å¼ï¼š10-100 req/s

#### è¾“å…¥å¤„ç†æ—¶é—´
- **å®šä¹‰**ï¼šå®Œæˆä¸€æ¬¡å®Œæ•´è¾“å…¥åºåˆ—çš„æ—¶é—´
- **å•ä½**ï¼šæ¯«ç§’ (ms)
- **æµ‹è¯•åºåˆ—**ï¼š"nihao" + é€‰æ‹©å€™é€‰è¯
- **å…¸å‹å€¼**ï¼š
  - DLLæ¨¡å¼ï¼š< 5 ms
  - Pythonæ¨¡å¼ï¼š50-200 ms

### æ€§èƒ½å¯¹æ¯”

æ ¹æ®æµ‹è¯•ç»“æœï¼Œä¸¤ç§å®ç°æ–¹æ¡ˆçš„æ€§èƒ½ç‰¹ç‚¹ï¼š

#### DLLæ–¹æ¡ˆ
**ä¼˜åŠ¿ï¼š**
- æä½å»¶è¿Ÿï¼ˆ< 1 msï¼‰
- é«˜ååé‡ï¼ˆ> 1000 req/sï¼‰
- å†…å­˜æ•ˆç‡é«˜
- æ— è¿›ç¨‹é—´é€šä¿¡å¼€é”€

**åŠ£åŠ¿ï¼š**
- å¹³å°ç›¸å…³æ€§å¼º
- ç¼–è¯‘å¤æ‚åº¦é«˜
- è°ƒè¯•å›°éš¾
- éœ€è¦å¤„ç†å†…å­˜ç®¡ç†

#### Pythonæ–¹æ¡ˆ
**ä¼˜åŠ¿ï¼š**
- è·¨å¹³å°å…¼å®¹æ€§å¥½
- å¼€å‘è°ƒè¯•ç®€å•
- æ˜“äºæ‰©å±•å’Œç»´æŠ¤
- ç‹¬ç«‹è¿›ç¨‹ï¼Œç¨³å®šæ€§å¥½

**åŠ£åŠ¿ï¼š**
- ç½‘ç»œé€šä¿¡å»¶è¿Ÿ
- ç›¸å¯¹è¾ƒä½çš„ååé‡
- é¢å¤–çš„è¿›ç¨‹å¼€é”€
- JSONåºåˆ—åŒ–å¼€é”€

### é€‰æ‹©å»ºè®®

#### é€‰æ‹©DLLæ–¹æ¡ˆçš„æƒ…å†µï¼š
- å¯¹æ€§èƒ½è¦æ±‚æé«˜çš„æ¸¸æˆ
- éœ€è¦æœ€å°åŒ–å»¶è¿Ÿçš„å®æ—¶åº”ç”¨
- ç›®æ ‡å¹³å°å›ºå®š
- æœ‰C++å¼€å‘ç»éªŒçš„å›¢é˜Ÿ

#### é€‰æ‹©Pythonæ–¹æ¡ˆçš„æƒ…å†µï¼š
- éœ€è¦è·¨å¹³å°éƒ¨ç½²
- å¼€å‘æ—¶é—´ç´§å¼ 
- éœ€è¦é¢‘ç¹ä¿®æ”¹è¾“å…¥æ³•é€»è¾‘
- å¯¹æ€§èƒ½è¦æ±‚ä¸æ˜¯ç‰¹åˆ«ä¸¥æ ¼

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. PythonæœåŠ¡å™¨å¯åŠ¨å¤±è´¥
**ç—‡çŠ¶ï¼š** é›†æˆæµ‹è¯•ä¸­"å¯åŠ¨PythonæœåŠ¡å™¨"å¤±è´¥
**åŸå› ï¼š**
- Pythonè„šæœ¬è·¯å¾„é”™è¯¯
- ç«¯å£è¢«å ç”¨
- æƒé™ä¸è¶³

**è§£å†³æ–¹æ³•ï¼š**
```bash
# æ£€æŸ¥ç«¯å£å ç”¨
netstat -an | grep 9999

# æ‰‹åŠ¨å¯åŠ¨æœåŠ¡å™¨
cd ../python_component
python3 ipc_server.py

# æ£€æŸ¥é”™è¯¯æ—¥å¿—
```

#### 2. DLLæµ‹è¯•å¤±è´¥
**ç—‡çŠ¶ï¼š** "DLLåŠŸèƒ½æµ‹è¯•"å¤±è´¥
**åŸå› ï¼š**
- DLLæ–‡ä»¶æœªç¼–è¯‘
- ç¼ºå°‘ä¾èµ–åº“
- æ¶æ„ä¸åŒ¹é…

**è§£å†³æ–¹æ³•ï¼š**
```bash
# é‡æ–°ç¼–è¯‘DLL
cd ../dll_component
./build.sh

# æ£€æŸ¥ç”Ÿæˆçš„æ–‡ä»¶
ls -la build/
```

#### 3. ç½‘ç»œè¿æ¥è¶…æ—¶
**ç—‡çŠ¶ï¼š** Pythonè¿æ¥æµ‹è¯•è¶…æ—¶
**åŸå› ï¼š**
- é˜²ç«å¢™é˜»æ­¢è¿æ¥
- æœåŠ¡å™¨æœªæ­£ç¡®å¯åŠ¨
- ç½‘ç»œé…ç½®é—®é¢˜

**è§£å†³æ–¹æ³•ï¼š**
```bash
# æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
sudo ufw status

# æµ‹è¯•æœ¬åœ°è¿æ¥
telnet 127.0.0.1 9999

# æ£€æŸ¥æœåŠ¡å™¨æ—¥å¿—
```

#### 4. æ€§èƒ½å¼‚å¸¸
**ç—‡çŠ¶ï¼š** æ€§èƒ½æµ‹è¯•ç»“æœå¼‚å¸¸
**åŸå› ï¼š**
- ç³»ç»Ÿè´Ÿè½½è¿‡é«˜
- ç½‘ç»œå»¶è¿Ÿ
- æµ‹è¯•ç¯å¢ƒä¸ç¨³å®š

**è§£å†³æ–¹æ³•ï¼š**
```bash
# æ£€æŸ¥ç³»ç»Ÿè´Ÿè½½
top
htop

# å…³é—­å…¶ä»–ç¨‹åº
# é‡æ–°è¿è¡Œæµ‹è¯•

# è°ƒæ•´æµ‹è¯•å‚æ•°
```

## è‡ªå®šä¹‰æµ‹è¯•

### æ·»åŠ æ–°çš„æµ‹è¯•ç”¨ä¾‹

1. **æ‰©å±•é›†æˆæµ‹è¯•ï¼š**
```python
def test_custom_functionality(self) -> bool:
    """è‡ªå®šä¹‰åŠŸèƒ½æµ‹è¯•"""
    try:
        # æ·»åŠ æµ‹è¯•é€»è¾‘
        return True
    except Exception as e:
        self.log(f"è‡ªå®šä¹‰æµ‹è¯•å¤±è´¥: {e}", "ERROR")
        return False

# åœ¨run_all_testsä¸­æ·»åŠ è°ƒç”¨
```

2. **æ‰©å±•æ€§èƒ½æµ‹è¯•ï¼š**
```python
def benchmark_custom_scenario(self) -> Dict[str, float]:
    """è‡ªå®šä¹‰åœºæ™¯æ€§èƒ½æµ‹è¯•"""
    # æ·»åŠ æ€§èƒ½æµ‹è¯•é€»è¾‘
    return results
```

### ä¿®æ”¹æµ‹è¯•å‚æ•°

å¯ä»¥é€šè¿‡ä¿®æ”¹è„šæœ¬ä¸­çš„å¸¸é‡æ¥è°ƒæ•´æµ‹è¯•å‚æ•°ï¼š

```python
# test_integration.py
class IntegrationTester:
    def __init__(self):
        self.server_host = "127.0.0.1"  # æœåŠ¡å™¨åœ°å€
        self.server_port = 9999         # æœåŠ¡å™¨ç«¯å£

# performance_benchmark.py
def benchmark_python_latency(self, iterations: int = 1000):  # æµ‹è¯•æ¬¡æ•°
def benchmark_python_throughput(self, duration: int = 10):   # æµ‹è¯•æ—¶é•¿
```

### æ·»åŠ æ–°çš„æ€§èƒ½æŒ‡æ ‡

```python
def benchmark_memory_usage(self) -> Dict[str, float]:
    """å†…å­˜ä½¿ç”¨æµ‹è¯•"""
    import psutil
    
    # æµ‹è¯•å†…å­˜ä½¿ç”¨æƒ…å†µ
    process = psutil.Process()
    memory_info = process.memory_info()
    
    return {
        'rss': memory_info.rss / 1024 / 1024,  # MB
        'vms': memory_info.vms / 1024 / 1024   # MB
    }
```

## æŒç»­é›†æˆ

### GitHub Actionsç¤ºä¾‹

```yaml
name: Unity Rime Tests

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v2
    
    - name: Set up Python
      uses: actions/setup-python@v2
      with:
        python-version: '3.8'
    
    - name: Install dependencies
      run: |
        sudo apt-get update
        sudo apt-get install cmake build-essential
    
    - name: Build DLL
      run: |
        cd dll_component
        ./build.sh
    
    - name: Run tests
      run: |
        cd tests
        python3 test_integration.py
        python3 performance_benchmark.py
    
    - name: Upload results
      uses: actions/upload-artifact@v2
      with:
        name: test-results
        path: tests/benchmark_results.json
```

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨å¼€æºè®¸å¯è¯ï¼Œå…·ä½“è®¸å¯è¯ä¿¡æ¯è¯·å‚è€ƒé¡¹ç›®æ ¹ç›®å½•çš„LICENSEæ–‡ä»¶ã€‚

